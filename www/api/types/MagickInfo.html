<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.72 [en] (X11; U; SunOS 5.6 sun4u) [Netscape]">
   <meta name="Author" content="Bob Friesenhahn">
   <meta name="Description" content="Description of MagickInfo structure members.">
   <title>ImageMagick MagickInfo Structure</title>
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#1F00FF" vlink="#9900DD" alink="#FF0000">

<center>
<h1>
ImageMagick MagickInfo Structure</h1></center>
The MagickInfo structure is used by ImageMagick to register support for
an Image format. The MagickInfo structure is allocated with default parameters
by calling <a href="../magick.html#SetMagickInfo">SetMagickInfo()</a>.
Image formats are registered by calling <a href="../magick.html">RegisterMagickInfo()</a>
which adds the initial structure to a linked list (at which point it is
owned by the list). A pointer to the structure describing a format may
be obtained by calling <a href="../magick.html#GetMagickInfo">GetMagickInfo()</a>.
Pass the argument NULL to obtain the first member of this list. A human-readable
list of registered image formats may be printed to a file descriptor by
calling <a href="../magick.html#ListMagickInfo">ListMagickInfo()</a>.
<p>Support for formats may be provided as a module which is part of the
ImageMagick library, provided by a module which is loaded dynamically at
run-time, or directly by the linked program. Users of ImageMagick will
normally want to create a loadable-module, or support encode/decode of
an image format directly from within their program.
<h3>
Sample Module:</h3>
The following shows sample code for a module called "GIF" (gif.c). Note
that the names of the Register and Unregister call-back routines are calculated
at run-time, and therefore must follow the rigid naming scheme <tt>RegisterFORMATImage</tt>
and <tt>UnregisterFORMATImage</tt>, respectively, where FORMAT is the upper-cased
name of the module file:
<p>/* Read image */
<br><tt>Image *ReadGIFImage(const ImageInfo *image_info)</tt>
<br><tt>{</tt>
<br><tt>&nbsp; [ decode the image ... ]</tt>
<br><tt>}</tt>
<p>/* Write image */
<br><tt>unsigned int WriteGIFImage(const ImageInfo *image_info,Image *image)</tt>
<br><tt>{</tt>
<br><tt>&nbsp; [ encode the image ... ]</tt>
<br><tt>}</tt>
<p><tt>/* Module call-back to register support for formats */</tt>
<br><tt>void RegisterGIFImage(void)</tt>
<br><tt>{</tt>
<br><tt>&nbsp; MagickInfo</tt>
<br><tt>&nbsp;&nbsp;&nbsp; *entry;</tt>
<p><tt>&nbsp; entry=SetMagickInfo("GIF");</tt>
<br><tt>&nbsp; entry->decoder=ReadGIFImage;</tt>
<br><tt>&nbsp; entry->encoder=WriteGIFImage;</tt>
<br><tt>&nbsp; entry->description=AllocateString("CompuServe graphics interchange
format");</tt>
<br><tt>&nbsp; entry->module=AllocateString("GIF");</tt>
<br><tt>&nbsp; RegisterMagickInfo(entry);</tt>
<br><tt>&nbsp; entry=SetMagickInfo("GIF87");</tt>
<br><tt>&nbsp; entry->decoder=ReadGIFImage;</tt>
<br><tt>&nbsp; entry->encoder=WriteGIFImage;</tt>
<br><tt>&nbsp; entry->adjoin=False;</tt>
<br><tt>&nbsp; entry->description=</tt>
<br><tt>&nbsp;&nbsp;&nbsp; AllocateString("CompuServe graphics interchange
format (version 87a)");</tt>
<br><tt>&nbsp; entry->module=AllocateString("GIF");</tt>
<br><tt>&nbsp; RegisterMagickInfo(entry);</tt>
<br><tt>}</tt>
<p><tt>/* Module call-back to unregister support for formats */</tt>
<br><tt>Export void UnregisterGIFImage(void)</tt>
<br><tt>{</tt>
<br><tt>&nbsp; UnregisterMagickInfo("GIF");</tt>
<br><tt>&nbsp; UnregisterMagickInfo("GIF87");</tt>
<br><tt>}</tt>
<h3>
Sample Application Code</h3>
Image format support provided within the user's application does not need
to implement the RegisterFORMATImage and UnregisterFORMATImage call-back
routines. Instead, the application takes responsibility for the registration
itself. An example follows:
<p>/* Read image */
<br><tt>Image *ReadGIFImage(const ImageInfo *image_info)</tt>
<br><tt>{</tt>
<br><tt>&nbsp; [ decode the image ... ]</tt>
<br><tt>}</tt>
<p>/* Write image */
<br><tt>unsigned int WriteGIFImage(const ImageInfo *image_info,Image *image)</tt>
<br><tt>{</tt>
<br><tt>&nbsp; [ encode the image ... ]</tt>
<br><tt>}</tt>
<p><tt>#include &lt;stdio.h></tt>
<br><tt>int main( void )</tt>
<br><tt>{</tt>
<br><tt>&nbsp; struct MagickInfo* info;</tt>
<p><tt>&nbsp; info = SetMagickInfo("GIF");</tt>
<p><tt>&nbsp; if ( info == (MagickInfo*)NULL )</tt>
<br><tt>&nbsp;&nbsp;&nbsp; exit(1);</tt>
<p><tt>&nbsp; info->decoder = ReadGIFImage;</tt>
<br><tt>&nbsp; info->encoder = WriteGIFImage;</tt>
<br><tt>&nbsp; info->adjoin&nbsp; = False;</tt>
<br><tt>&nbsp; info->description = AllocateString("CompuServe graphics
interchange format");</tt>
<br><tt>&nbsp; /* Add MagickInfo structure to list */</tt>
<br><tt>&nbsp; RegisterMagickInfo(info);</tt>
<p><tt>&nbsp; info = GetMagickInfo("GIF");</tt>
<br><tt>&nbsp; [ do something with info ... ]</tt>
<p><tt>&nbsp; ListMagickInfo( stdout );</tt>
<br><tt>&nbsp; return;</tt>
<br><tt>}</tt>
<h3>
MagickInfo Structure Definition</h3>
The members of the MagickInfo structure are shown in the following table:
<br>&nbsp;
<table BORDER WIDTH="100%" BGCOLOR="#CCCCCC" NOSAVE >
<caption><b>MagickInfo Structure Members</b></caption>

<tr>
<td>
<center><b>Member</b></center>
</td>

<td>
<center><b>Type</b></center>
</td>

<td>
<center><b>Description</b></center>
</td>
</tr>

<tr>
<td>adjoin</td>

<td>unsigned int</td>

<td>Set to non-zero (True) if this file format supports multi-frame images.</td>
</tr>

<tr>
<td>blob_support</td>

<td>unsigned int</td>

<td>Set to non-zero (True) if the encoder and decoder for this format supports
operating on arbitrary BLOBs (rather than only disk files).</td>
</tr>

<tr>
<td>data</td>

<td>void *</td>

<td>User specified data. A way to pass any sort of data structure to the
endoder/decoder. To set this, <a href="../magick.html#GetMagickInfo">GetMagickInfo()</a>
must be called to first obtain a pointer to the registered structure since
it can not be set via a <a href="/home/bfriesen/src/graphics/ImageMagick/www/api/magick.html">RegisterMagickInfo()</a>
parameter.</td>
</tr>

<tr NOSAVE>
<td>decoder</td>

<td NOSAVE><a href="Image.html">Image</a> *(*decoder)(const <a href="ImageInfo.html">ImageInfo</a>
*)</td>

<td>Function to decode image data and return ImageMagick Image.</td>
</tr>

<tr>
<td>description</td>

<td>char *</td>

<td>Long form image format description (e.g. "CompuServe graphics interchange
format").</td>
</tr>

<tr>
<td>encoder</td>

<td>unsigned int (*encoder)(const <a href="ImageInfo.html">ImageInfo</a>
*, Image *)</td>

<td>Function to encode image data with options passed via <a href="ImageInfo.html">ImageInfo</a>
and image represented by <a href="Image.html">Image</a>.</td>
</tr>

<tr>
<td>module</td>

<td>char *</td>

<td>Name of module (e.g. "GIF") which registered this format. Set to NULL
if format is not registered by a module.</td>
</tr>

<tr>
<td>name</td>

<td>const char *</td>

<td>Magick string (e.g. "GIF") which identifies this format.</td>
</tr>

<tr>
<td>next</td>

<td>MagickInfo</td>

<td>Next MagickInfo struct in linked-list. NULL if none.</td>
</tr>

<tr>
<td>previous</td>

<td>MagickInfo</td>

<td>Previous MagickInfo struct in linked-list. NULL if none.</td>
</tr>

<tr>
<td>raw</td>

<td>unsigned int</td>

<td>Image format does not contain size (must be specified in ImageInfo).</td>
</tr>
</table>

<p>
<hr>
<p><a href="../../../ImageMagick.html"><img SRC="../../../images/home.png" ALT="Home Page" BORDER=0 height=40 width=40 align=CENTER></a><font size=-2>
Image manipulation software that works like magic.</font>
</body>
</html>
